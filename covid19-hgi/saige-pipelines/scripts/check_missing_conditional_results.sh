#!/bin/bash

### checks output from conditional pipeline and generates config for missing results.

# where the conditional result files were copied.
target_bucket=$1
## conditional analysis config generated by generate_analysis_config step
analysis_config=$2

missing_conf_name=$3

gsutil ls $target_bucket"*.independent.snps" > results
join -v 1 -1 1 -2 1 <(awk -v b=$target_bucket 'BEGIN{OFS="\t"}{ n=split($1,a,"/");  print b""a[n]"_"$9".independent.snps",$0}' $analysis_config | sort -b -k 1,1 ) <(sort -b -k 1,1 results) | tr ' ' '\t' | cut -f 2- > $missing_conf_name
